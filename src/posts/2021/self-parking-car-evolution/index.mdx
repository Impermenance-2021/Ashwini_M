---

title: "Self-Parking Car in <500 Lines of Code"

summary: "Training the car to do self-parking using a genetic algorithm"

cover: assets/01-cover-00.jpg

date: 2021-09-18

---

![Self-Parking car evolution](assets/01-cover-01.jpg)

## TL;DR

In this article we'll train the car to do self-parking using a [genetic algorithm](https://en.wikipedia.org/wiki/Genetic_algorithm).

We'll create **the 1st generation** of cars with random genomes that will behave something like this:

![The 1st generation of cars with random genomes](assets/02-cars-before-01.gif)

**On the ‚âà40th generation** the cars start learning what the self-parking is and start getting closer to the parking spot:

![The 40th generation start learning how to park](assets/03-car-after-01.gif)

Another example with a bit more challenging starting point:

![More challenging starting point for self-parking](assets/03-car-after-03.gif)

> Yeah-yeah, the cars are hitting some other cars along the way, bit this is only the 40th generation since the creation of the world for them, so be merciful and give them some space to grow :D

You may launch the üöï [Self-parking Car Evolution Simulator](https://trekhleb.dev/self-parking-car-evolution) to see the evolution process directly in you browser. The simulator gives you the following opportunities:

- You may [train the cars from scratch](https://trekhleb.dev/self-parking-car-evolution?parking=evolution#/) and adjust genetic parameters by yourself
- You may [see the trained (almost) self-parking cars in action](https://trekhleb.dev/self-parking-car-evolution?parking=automatic#/)
- You may also [try to park the car manually](https://trekhleb.dev/self-parking-car-evolution?parking=manual#/).

The genetic algorithm for this project is implemented in TypeScript. The full genetic source code will be shown in this article, but you may also find the final code examples in the [Evolution Simulator repository](https://github.com/trekhleb/self-parking-car-evolution).

> ‚ÑπÔ∏è We're going to use a genetic algorithm for particular task of evolving cars genomes. However, this article only touches on the basics of the algorithm and is by no means a complete guide to the genetic algorithm topic.

Having that said, let's deep dive into more details...

## Giving the muscles to the car

To be able to move, the car would need "muscles". Let's give the car two types of muscles:

1. **Engine muscle** - allows the car to move *‚Üì back*, *‚Üë forth*, or *‚óé stand steel* (neutral)
2. **Steering wheel muscle** - allows the car to turn *‚Üê left*, *‚Üí right*, or *‚óé go straight* while moving

With these two muscles the car is able to perform the movements like these:

![Car movements achieved by car muscles](assets/03-car-muscles-01.gif)

> You may [use the Evolution Simulator](https://trekhleb.dev/self-parking-car-evolution?parking=manual#/) and try to park the car manually to see how the car muscles work.

In our case, the muscles are receivers of the signals that comes from the brain once every `100ms`. Based on the value of the brain's signal the muscles acts differently. We'll cover the "brain" part below, but for now, let's say that our brain may send a signal that is just a `float` number in a range of `[0...1]` (i.e. `0`, or `0.945`, etc.).

For example, the brain may send the signal with the value of `0.992` (close to `1`) to the engine muscle and it will start moving the car forward. At the same time, if the brain will send the signal of `0.0002` (close to `0`) to the steering wheel muscle, it will turn the car to the left.

Here is how the brain signal values map to the muscle actions in our case:

| Muscle \ `Signal`  | `‚âà 0`      | `‚âà 0.5`     | `‚âà 1`      |
| :----------------- | :--------- | :---------- | :--------- |
| **Engine**         | ‚Üë Forward  | ‚óé Neutral   | ‚Üì Backward |
| **Steering wheel** | ‚Üê Left     | ‚óé Straight  | ‚Üí Right    |

## Giving the eyes to the car

Before our car will learn how to do self-parking using its muscles, it needs to be able to "see" the surroundings. Let's give it the `8` "eyes" in a form of distance sensors:

- Each sensor can detect the obstacle in a distance range of `0-4m` (meters).
- Each sensor "reports" the latest information about the obstacles it "sees" to the car's "brain" every `100ms`.
- Whenever the sensor doesn't "see" any obstacles it "reports" the value of `0`. On the contrary, if the value of the sensor is small but not zero (i.e. `0.01m`) it would mean that the obstacle is really close.

![Car sensors with distances](assets/04-sensors-01.jpg)

## Giving the brain to the car

At this moment, our car can "see" and "move", but there is no "coordinator" for it, that would transform the signals from the "eyes" to the proper movements of the "muscles" - we need to give the car a "brain".

## Evolving the car's brain
